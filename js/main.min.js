/*! Polycademy2 built on 2013-04-27 by Roger Qiu <roger.qiu@polycademy.com> */
"use strict";var app=angular.module("App",["Controllers","Filters","Services","Directives","ngResource","ngCookies","ui","ui.bootstrap"]);angular.module("Controllers",[]),angular.module("Filters",[]),angular.module("Services",[]),angular.module("Directives",[]),app.config(["$routeProvider","$locationProvider","UsersServProvider",function(e,t,n){n.setLoginPage="/auth",t.html5Mode(!0).hashPrefix("!"),e.when("/",{templateUrl:"home_index.html",controller:"HomeIndexCtrl"}).when("/auth",{templateUrl:"auth_index.html",controller:"AuthIndexCtrl"}).when("/courses",{templateUrl:"courses_index.html",controller:"CoursesIndexCtrl"}).when("/blog",{templateUrl:"blog_index.html",controller:"BlogIndexCtrl"}).when("/canvas",{templateUrl:"canvas_index.html",controller:"CanvasIndexCtrl"}).otherwise({redirectTo:"/"})}]),app.run(["$rootScope","$cookies","$http",function(e,t,n){e.$watch(function(){return t[serverVars.csrfCookieName]},function(){n.defaults.headers.common["X-XSRF-TOKEN"]=t[serverVars.csrfCookieName]})}]),angular.module("Controllers").controller("AuthIndexCtrl",["$scope","UsersServ",function(e,t){e.logout=function(){e.$emit("authenticationDestroy",t.getUserData().id)},e.login=function(){var n={username:e.loginForm.username,password:e.loginForm.password,rememberMe:e.loginForm.rememberMe};e.loginErrors=[],e.validationErrors={},t.loginSession(n,function(){console.log("We are logged in")},function(t){console.log("Login failed, here's the errors."),"validation_error"===t.data.code&&(Array.isArray(t.data.content)?e.loginErrors=t.data.content:e.validationErrors={username:t.data.content.username,password:t.data.content.password,rememberMe:t.data.content.rememberMe})}),e.$on("authenticationProvided",function(){var n=t.getUserData();console.log(n),e.state=!0})}}]),angular.module("Controllers").controller("BlogIndexCtrl",["$scope","UsersServ",function(e){e.codeMirrorModel='var Hello =  "world";',e.oneAtATime=!0,e.groups=[{title:"Dynamic Group Header - 1",content:"Dynamic Group Body - 1"},{title:"Dynamic Group Header - 2",content:"Dynamic Group Body - 2"}],e.items=["Item 1","Item 2","Item 3"],e.addItem=function(){var t=e.items.length+1;e.items.push("Item "+t)}}]),angular.module("Controllers").controller("CanvasIndexCtrl",["$scope","UsersServ","WebSocketsServ",function(e,t,n){n.connect("chat",function(e){console.log(e),n.call("chat","http://polycademy.com/chat","createRoom",["12355"]).then(function(e){console.log("got result: "+e)},function(e,t){console.log("error: "+t)})},function(e,t){console.log(e,"<- CODE"),console.log(t,"<- REASON")})}]),angular.module("Controllers").controller("CoursesIndexCtrl",["$scope","CoursesServ",function(e,t){t.get({},function(e){console.log(e)},function(){})}]),angular.module("Controllers").controller("DummyIndexCtrl",["$scope",function(e){e.accountId=4;for(var t=[{id:1,userId:2,name:"Sarah"},{id:2,userId:4,name:"David"},{id:3,userId:4,name:"Dominic"}],n=[],o=0;t.length>o;o++)t[o].userId===e.accountId&&n.push(t[o]);e.children=n}]).controller("ChildSubCtrl",["$scope",function(e){console.log(e.child.id);for(var t=[{id:1,childId:2,planTitle:"Hello world!"},{id:2,childId:3,planTitle:"Yeaa"},{id:4,childId:3,planTitle:"Another Plan"},{id:3,childId:4,plantTitle:"Blastoise"}],n=[],o=0;t.length>o;o++)t[o].childId===e.child.id&&n.push(t[o]);e.plans=n}]).controller("PlanSubCtrl",["$scope",function(){}]),angular.module("Controllers").controller("FooterCtrl",["$scope","httpMessages",function(e,t){e.httpMessages=t}]),angular.module("Controllers").controller("HeaderCtrl",["$scope",function(e){e.testData="Hello World!"}]),angular.module("Controllers").controller("HomeIndexCtrl",["$scope",function(e){e.data="HELLO WORLD!"}]),angular.module("Directives").directive("chessCanvasDir",["UtilitiesServ","KineticServ","$timeout",function(){return{scope:!0,link:function(){}}}]),angular.module("Directives").directive("equaliseHeightsDir",[function(){return{scope:{},link:function(e,t,n){var o=t.find(n.equaliseHeightsDir),r=function(){var e=0;o.height("auto").each(function(){e=angular.element(this).height()>e?angular.element(this).height():e}).height(e)};r(),angular.element(window).resize(r)}}}]),angular.module("Directives").directive("fadeInOutDir",[function(){return{link:function(e,t,n){t.parent().show(),t.hide().fadeIn("fast").delay(n.fadeInOutDir).fadeOut("slow",function(){t.is(":last-child")&&t.parent().hide()})}}}]),angular.module("Directives").directive("widgetDir",[function(){return{templateUrl:"directive_widget.html",link:function(e,t,n){console.log(e),console.log(t),console.log(n)}}}]),angular.module("Filters").filter("Interpolate",[function(){return function(e){return(e+"").replace(/\%VERSION\%/gm,"example")}}]),angular.module("Services").factory("AccountsServ",["$resource",function(e){return e("api/accounts/:id",{},{update:{method:"PUT"}})}]),angular.module("Services").config(["$httpProvider",function(e){var t=0,n=$(".ajax_loader");e.responseInterceptors.push(["$q",function(e){return function(o){return t++,n.show(),o.then(function(e){return--t||n.hide(),e},function(o){return--t||n.hide(),e.reject(o)})}}])}]),angular.module("Services").factory("AutobahnServ",[function(){return ab}]),angular.module("Services").factory("CoursesServ",["$resource",function(e){return e("api/courses/:id",{},{update:{method:"PUT"}})}]),angular.module("Services").config(["$provide","$httpProvider",function(e,t){var n=[];e.value("httpMessages",n),t.responseInterceptors.push(["$q",function(e){return function(t){return t.then(function(e){switch(e.config.method.toUpperCase()){case"GET":n.push({message:"Successfully Received",type:"success"});break;case"POST":n.push({message:"Successfully Posted",type:"success"});break;case"PUT":n.push({message:"Successfully Updated",type:"success"});break;case"DELETE":n.push({message:"Sucessfully Deleted",type:"success"})}return e},function(t){switch(t.status){case 400:n.push({message:"Validation failed, try tweaking your submission.",type:"failure"});break;case 401:n.push({message:"Unauthorised request, try logging in.",type:"failure"});break;case 403:n.push({message:"Unauthorised request, you don't have the permissions to view this.",type:"failure"});break;case 404:n.push({message:"404, sorry could not find what you were looking for.",type:"failure"});break;case 405:n.push({message:"The requested method was incompatible with the requested resource.",type:"failure"});break;case 500:n.push({message:"There was a server error, try again later, or contact the owners.",type:"failure"});break;default:n.push({message:t.status+" General error processing the request",type:"failure"})}return e.reject(t)})}}])}]),angular.module("Services").factory("KineticServ",[function(){return Kinetic}]),angular.module("Services").factory("SessionsServ",["$resource",function(e){return e("api/sessions/:id",{},{update:{method:"PUT"}})}]),angular.module("Services").config(["$httpProvider",function(e){e.responseInterceptors.push(["$q","$rootScope",function(e,t){return function(n){return n.then(function(e){return e},function(n){if(401===n.status||403===n.status){var o=e.defer(),r={config:n.config,deferred:o};return t.$broadcast("authenticationPartial",r),o.promise}return e.reject(n)})}}])}]).provider("UsersServ",function(){var e={},t="",n="/auth",o=!1,r=[];this.setLoginPage=function(e){n=e},this.$get=["$rootScope","$location","$http","AccountsServ","SessionsServ",function(i,a,s,u,c){var l={getUserData:function(){return e},setUserData:function(t){angular.extend(e,t)},registerAccount:function(e,t,n){u.save({},e,function(n){i.$broadcast("authenticationRegister",e),"function"==typeof t&&t(n)},function(e){"function"==typeof n&&n(e)})},deleteAccount:function(e,t,n){u.remove({id:e},function(n){i.$broadcast("authenticationDestroy",e),"function"==typeof t&&t(n)},function(e){"function"==typeof n&&n(e)})},getAccount:function(t,n,o){u.get({id:t},function(t){e=t.content,i.$broadcast("authenticationProvided",e),"function"==typeof n&&n(t)},function(e){"function"==typeof o&&o(e)})},loginSession:function(e,t,n){c.save({},e,function(e){i.$broadcast("authenticationLogin",e.content),"function"==typeof t&&t(e)},function(e){"function"==typeof n&&n(e)})},logoutSession:function(t,n,o){t=t||0,c.remove({id:t},function(t){i.$broadcast("authenticationLogout",t.content),e={},"function"==typeof n&&n(t)},function(e){"function"==typeof o&&o(e)})},getSession:function(e,t,n){c.get({id:e},function(e){e.content.userId!==void 0&&i.$broadcast("authenticationLogin",e.content.userId),"function"==typeof t&&t(e)},function(e){"function"==typeof n&&n(e)})}};return i.$on("authenticationPartial",function(n,i){0===Object.keys(e).length&&(t="",o=!0,r.push(i))}),i.$on("authenticationFull",function(){0===Object.keys(e).length&&(t=a.path,a.path(n))}),i.$on("authenticationRegister",function(e,n){t="/",l.loginSession({username:n.username,password:n.password})}),i.$on("authenticationDestroy",function(e,n){t="/",l.logoutSession(n)}),i.$on("authenticationLogin",function(e,n){l.getAccount(n),t&&(a.path(t),t="");var i=function(e){s(e.config).then(function(t){e.deferred.resolve(t)},function(t){e.deferred.reject(t)})};if(o){for(var u=0;r.length>u;u++)i(r[u]);o=!1,r=[]}}),i.$on("authenticationLogout",function(){t&&(a.path(t),t="")}),l}]}).run(["UsersServ",function(e){e.getSession(0)}]),angular.module("Services").service("UtilitiesServ",["$window","$timeout",function(e,t){this.requestAnimationFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){t(e,1e3/60)}}().bind(e),this.type=function(e){return Object.prototype.toString.call(e).slice(8,-1)},this.canvasPreloadImages=function(e,t){if("Object"!==this.type(e)||"Function"!==this.type(t))return!1;var n={},o=0,r=Object.keys(e).length,i=function(){return function(){++o>=r&&t(n)}};for(var a in e)e.hasOwnProperty(a)&&(n[a]=new Image,n[a].onload=i(),n[a].src=e[a])}}]),angular.module("Services").factory("WebSocketsServ",["$location","AutobahnServ",function(e,t){var n={},o={protocol:"ws://",host:e.host(),port:8080},r={getSessions:function(){return n},setupConfig:function(e){angular.extend(o,e)},connect:function(e,r,i,a){var s;s=e?"/"+e:"";var u=o.protocol+o.host+":"+o.port+s;t.connect(u,function(t){n[e]=t,r(t)},function(t,o){i(t,o),n[e]!==void 0&&delete n[e]},a)},call:function(e,t,o,r){var i=n[e],a=t+"#"+o,s=[a];return s.concat(r),i.call.apply(null,s)}};return r}]);